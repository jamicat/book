<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>>Deerbook</title>
  <style>
    @font-face {
      font-family: 'hack-regular';
      src: url('hack-regular.ttf') format('truetype');
    }

    @font-face {
      font-family: 'honeybee';
      src: url('honeybee.ttf') format('truetype');
    }

    @font-face {
      font-family: 'nunito';
      src: url('nunito.ttf') format('truetype');
    }


    @media (max-width: 1080px) and (max-height: 2400px) {
    .species-buttons {
      display: flex;
      flex-wrap: wrap;
      margin-bottom: 15px;
      justify-content: center;
      gap: 5px;
    }
    .form-container {
    padding: 20px; 
    }
    }

    @media (max-width: 1366px) and (max-height: 768px) { 
    body {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    margin: 0;
	  }
    }


 .header-container {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 10px;
}

.header-container img {
  height: 60px; 
  margin-top: -30px;
  border-radius: 50%;
}

   body {
  font-family: 'Courier New', monospace;
  margin: 0;
  padding: 0;
  background-color: #C3E6C5;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
}

h1 {
  text-align: center;
  margin-top: 20px;
  font-size: 4.3em;
  color: #ffffff; 
  font-family: 'nunito', sans-serif;
  text-shadow: 
    -2px -2px 0 #77D9D7, 
    2px -2px 0 #77D9D7, 
    -2px 2px 0 #77D9D7, 
    2px 2px 0 #77D9D7; 
}

h1 span {
  color: #77D9D7; 
}

label {
  display: block;
  margin-bottom: 8px;
  font-weight: bold;
  color: #225F5F;
  font-family: 'nunito', sans-serif; 
  font-size: 0.9em;
}

.form-container {
  margin: 20px auto;
  width: 92%;
  max-width: 640px;
  padding: 15px;
  background: #B0F0EC; 
  border-radius: 10px;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
}

.form-container input,
.form-container textarea {
  width: 100%;
  padding: 10px;
  margin-bottom: 15px;
  border: 2px solid #4CB6B6; 
  border-radius: 5px;
  font-size: 1em;
  background: #E2FAF8; 
  color: #225F5F; 
  box-sizing: border-box;
}

.form-container textarea {
  resize: none;
}

.species-buttons {
  display: flex;
  gap: 5px;
  margin-bottom: 15px;
}

.species-buttons button {
  font-size: 1.5rem;
  border: none;
  background: none;
  cursor: pointer;
}

.species-buttons button:hover {
  flex: 1 1 auto;
  transform: scale(1.2);
  filter: drop-shadow(0px 0px 5px #4CB6B6);
}

.comments-section {
  margin: 20px auto;
  width: 90%;
  max-width: 600px;
}

.comment {
  background-color: #B0F0EC; 
  color: #225F5F; 
  padding: 20px;
  margin-bottom: 15px;
  border-radius: 10px;
  border: 2px solid #4CB6B6;
  font-family: 'Arial', sans-serif;
  font-size: 0.9rem;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
}

.comment iframe {
  width: 100%; 
  height: auto; 
  aspect-ratio: 16 / 9; 
  border-radius: 8px; 
  max-width: 100%; 
}

.comment h4 {
  margin: 0 0 5px;
  color: #155E5E;
}

.comment small {
  display: block;
  margin-top: 5px;
  color: #447F7F;
}

.submit-button {
  display: block;
  margin: 20px auto;
  background-color: #4CB6B6;
  transition: background-color 0.3s, transform 0.2s;
  color: white;
  padding: 10px 20px;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-size: 1em;
  font-family: 'hack-regular';
}

.submit-button:hover {
  background-color: #38A3A3;
  transform: scale(1.05);
}

.submit-button:active {
  background-color: #2D8787;
  transform: scale(0.95);
}

.home-btn {
  display: block;
  margin: 20px auto;
  background-color: #4CB6B6;
  transition: background-color 0.3s, transform 0.2s;
  color: white;
  padding: 10px 20px;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-size: 1em;
  font-family: 'hack-regular';
}

.home-btn:hover {
  background-color: #38A3A3;
  transform: scale(1.05);
}

.home-btn:active {
  background-color: #2D8787;
  transform: scale(0.95);
}

  </style>
</head>


  
<body>
 <div class="header-container">
  <img src="deer.png" alt="Deer Fursona">
  <h1>Guestbook</h1>
</div>

  <div class="form-container">
    <form id="guestbook-form">
      <label for="name">Name:</label>
      <input type="text" id="name" name="name" required required placeholder="Anonymous">

      <label for="comment">Comment:</label>
      <textarea id="comment" name="comment" rows="4" maxlength="10000" required placeholder="Comments are public! Please be nice."></textarea>

      <label for="question">Favourite food:</label>
      <input type="text" id="question" name="question" placeholder="Optional">

      <label for="species">Species:</label>
      <div class="species-buttons" id="species-buttons">
        <button type="button" data-species="üê±">üê±</button>
        <button type="button" data-species="üê∂">üê∂</button>
        <button type="button" data-species="üê∫">üê∫</button>
        <button type="button" data-species="ü¶ä">ü¶ä</button>
        <button type="button" data-species="ü¶Å">ü¶Å</button>
        <button type="button" data-species="üê∞">üê∞</button>
        <button type="button" data-species="üêÆ">üêÆ</button>
        <button type="button" data-species="ü¶å">ü¶å</button>
        <button type="button" data-species="üêê">üêê</button>
        <button type="button" data-species="ü¶à">ü¶à</button>
        <button type="button" data-species="üêâ">üêâ</button>
        <button type="button" data-species="ü¶ã">ü¶ã</button>
        <button type="button" data-species="‚ùì">‚ùì</button>
      </div>

      <button type="submit" class="submit-button">Submit</button>
      <button class="home-btn" id="home-btn" onclick="window.location.href='/';">Home</button>
    </form>
  </div>

  <div class="comments-section" id="comments-section"></div>

  <button id="mode-toggle" style="
  position: fixed;
  bottom: 20px;
  right: 20px;
  background-color: #4CB6B6;
  color: white;
  border: none;
  padding: 10px 20px;
  border-radius: 50px;
  cursor: pointer;
  font-size: 1em;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
">Mode: ü¶å</button>

  <script>
    const form = document.getElementById('guestbook-form');
    const commentsSection = document.getElementById('comments-section');
    const speciesButtons = document.querySelectorAll('#species-buttons button');
    let selectedSpecies = '';

    const webAppUrl = 'https://script.google.com/macros/s/AKfycbx7bzct-SU2XZ0OgiSQhH76NGyh6oSHkngglBgWLd9-wr76G4uPvtjRw31DifL59iadtA/exec';

    const cooldownPeriod = 5 * 60 * 1000;

    speciesButtons.forEach(button => {
      button.addEventListener('click', () => {
        selectedSpecies = button.dataset.species;
        speciesButtons.forEach(btn => btn.style.opacity = '0.5');
        button.style.opacity = '1';
      });
    });

    form.addEventListener('submit', (e) => {
      e.preventDefault();

      const lastSubmissionTime = localStorage.getItem('lastSubmissionTime');
      const now = Date.now();

      if (lastSubmissionTime && now - lastSubmissionTime < cooldownPeriod) {
        alert('5 minutes between each comment, please!');
        return;
      }

      const name = document.getElementById('name').value.trim();
      const commentText = document.getElementById('comment').value.trim();
      const question = document.getElementById('question').value.trim() || null;


      if (!name || !commentText) {
        alert('Name and comment cannot be empty!');
        return;
      }

      const data = {
        name,
        species: selectedSpecies || '‚ùì',
        comment: commentText,
        question,
      };

      fetch(webAppUrl, {
        method: 'POST',
        mode: 'no-cors',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data),
      });

      localStorage.setItem('lastSubmissionTime', now);

      form.reset();
      selectedSpecies = '';
      speciesButtons.forEach(btn => btn.style.opacity = '1');
      loadComments();
    });

    async function loadComments() {
  try {
    const response = await fetch(webAppUrl);
    if (!response.ok) throw new Error('Failed to load comments.');

    
    const { comments = [], questions = [] } = await response.json();
    console.log('Fetched comments and questions:', { comments, questions });

    commentsSection.innerHTML = '';
    comments
      .slice() 
      .reverse() 
      .forEach(({ timestamp, name, species, comment }) => {
        const questionData = questions.find(q => {
        const commentTimestamp = new Date(timestamp).toISOString().slice(0, 19); 
        const questionTimestamp = new Date(q.timestamp).toISOString().slice(0, 19); 
        return (
    q.name.trim().toLowerCase() === name.trim().toLowerCase() &&
    commentTimestamp === questionTimestamp
  );
});
        const questionText = questionData ? questionData.question : null;

        const commentEl = document.createElement('div');
        commentEl.classList.add('comment');

        const nameEl = document.createElement('h4');
        nameEl.textContent = `${species || '‚ùì'} ${name || 'Anonymous'}`;
        commentEl.appendChild(nameEl);

         
const textEl = document.createElement('p');
const ytRegex = /(?:https?:\/\/)?(?:www\.)?(?:youtube\.com\/watch\?v=|youtu\.be\/)([a-zA-Z0-9_-]+)/g;
const match = comment.match(ytRegex);
if (match) {
  const videoId = match[0].split("v=")[1]?.split("&")[0] || match[0].split("/").pop().split("?")[0];
  const iframe = document.createElement('iframe');
  iframe.width = "100%"; 
  iframe.height = "315";
  iframe.src = `https://www.youtube.com/embed/${videoId}`;
  iframe.frameBorder = "0";
  iframe.allowFullscreen = true;
  iframe.style.borderRadius = "8px"; 
  const filteredComment = comment.replace(ytRegex, "").trim();
  if (filteredComment) {
    textEl.textContent = filteredComment;
    commentEl.appendChild(textEl);
  }
  commentEl.appendChild(iframe);
} else {
  textEl.textContent = comment || 'No comment provided.';
  commentEl.appendChild(textEl);
}



        
       if (questionText) {
  const questionEl = document.createElement('p');
  questionEl.textContent = `Favourite food: ${questionText}`;
  commentEl.appendChild(questionEl);
}

        const dateEl = document.createElement('small');
        dateEl.textContent = timestamp ? formatDate(timestamp) : 'Invalid Date';
        commentEl.appendChild(dateEl);

        commentsSection.appendChild(commentEl);
      });
  } catch (error) {
    console.error('Error loading comments:', error.message);
    commentsSection.innerHTML = '<p>Failed to load comments. Please try again later.</p>';
  }
}

    function formatDate(timestamp) {
      if (timestamp.includes('/')) return timestamp;
      const date = new Date(timestamp);
      if (isNaN(date)) return 'Invalid Date';
      return `${date.getDate().toString().padStart(2, '0')}/${
        (date.getMonth() + 1).toString().padStart(2, '0')
      }/${date.getFullYear()}, ${date.toLocaleTimeString()} `;
    }

  setTimeout(() => {
    loadComments();
  }, 500);





	  
	  


const modeToggleButton = document.getElementById('mode-toggle');
const header = document.querySelector('h1');
const body = document.body;
const commentBoxes = document.querySelectorAll('.comment');
const submitButton = document.querySelector('.submit-button');
const homeButton = document.querySelector('.home-btn');

let isDeerMode = true;

modeToggleButton.addEventListener('click', () => {
  if (isDeerMode) {
    
    switchToCatMode();
  } else {
   
    switchToDeerMode();
  }
  isDeerMode = !isDeerMode;
});

function switchToCatMode() {

  modeToggleButton.textContent = 'Mode: üêà';
  

  header.style.color = '#ffe7cd';
  header.style.textShadow = `
    -1px -1px 0 #FFB6C1CC, 
     1px -1px 0 #FFB6C1CC, 
    -1px 1px 0 #FFB6C1CC, 
     1px 1px 0 #FFB6C1CC
  `;
  document.querySelector('h1 span').style.color = 'pink';
  document.title = 'Catbook';
  header.textContent = 'Catbook';
  
  document.querySelectorAll('label').forEach(label => label.style.color = 'brown');
  body.style.backgroundColor = 'beige';

  commentBoxes.forEach(comment => {
    comment.style.backgroundColor = 'rgba(255, 231, 205, 1)';
    comment.style.color = '#333';
    comment.style.border = '1px solid rgba(255, 192, 203, 0.6)';
  });

  document.querySelectorAll('.comment small').forEach(small => {
    small.style.color = 'grey';
  });


  updateButtonStyles(submitButton, '#ffb6c1', '#ff9a9e', '#e6788e', 'black');
  updateButtonStyles(homeButton, '#ffb6c1', '#ff9a9e', '#e6788e', 'black');
}

function switchToDeerMode() {
  modeToggleButton.textContent = 'Mode: ü¶å';


  header.style.color = '#ffffff';
  header.style.textShadow = `
    -2px -2px 0 #77D9D7, 
     2px -2px 0 #77D9D7, 
    -2px 2px 0 #77D9D7, 
     2px 2px 0 #77D9D7
  `;
  document.querySelector('h1 span').style.color = '#77D9D7';
  document.title = 'Deerbook';
  header.textContent = 'Guestbook';
  
  document.querySelectorAll('label').forEach(label => label.style.color = '#225F5F');
  body.style.backgroundColor = '#C3E6C5';

  commentBoxes.forEach(comment => {
    comment.style.backgroundColor = '#B0F0EC';
    comment.style.color = '#225F5F';
    comment.style.border = '2px solid #4CB6B6';
  });

  document.querySelectorAll('.comment small').forEach(small => {
    small.style.color = '#447F7F';
  });


  updateButtonStyles(submitButton, '#4CB6B6', '#38A3A3', '#2D8787', 'white');
  updateButtonStyles(homeButton, '#4CB6B6', '#38A3A3', '#2D8787', 'white');
}


function updateButtonStyles(button, bgColor, hoverColor, activeColor, textColor) {
  button.style.backgroundColor = bgColor;
  button.style.color = textColor;

  button.addEventListener('mouseover', () => {
    button.style.backgroundColor = hoverColor;
  });

  button.addEventListener('mouseout', () => {
    button.style.backgroundColor = bgColor;
  });

  button.addEventListener('mousedown', () => {
    button.style.backgroundColor = activeColor;
  });

  button.addEventListener('mouseup', () => {
    button.style.backgroundColor = hoverColor;
  });
}
  
  </script>






	
</body>
</html>
